<!--
  主入口模板 —— 生成 index.html 时以此为骨架
  替换标记：
    {{PRESENTATION_TITLE}}  → 演示文稿标题
    {{SLIDES_ARRAY}}        → JS slides 数组字符串
    {{TOTAL_SLIDES}}        → 总页数
    {{THEME_CSS}}           → 主题内联 CSS 变量
-->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{PRESENTATION_TITLE}}</title>
<style>
  {{THEME_CSS}}
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body { width: 100%; height: 100%; background: var(--bg, #030308); overflow: hidden; font-family: 'Noto Sans SC', sans-serif; }

  .stage {
    width: 100vw; height: 100vh;
    display: flex; align-items: center; justify-content: center;
    background: radial-gradient(ellipse at center, var(--bg-radial, #0a0a20) 0%, var(--bg, #030308) 70%);
  }
  .frame-wrap {
    position: relative;
    box-shadow: 0 0 0 1px rgba(0,245,255,0.15), 0 0 60px rgba(0,245,255,0.06);
  }
  iframe { display: block; border: none; width: 100%; height: 100%; }

  /* 导航控件 */
  .nav-ctrl {
    position: fixed; bottom: 16px; right: 18px;
    display: flex; align-items: center; gap: 6px; z-index: 1000;
  }
  .nav-btn {
    width: 32px; height: 32px; border-radius: 3px;
    background: rgba(5,5,20,0.85); border: 1px solid rgba(0,245,255,0.2);
    color: var(--neon-primary, #00f5ff); font-size: 13px; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    opacity: 0.7; transition: all 0.2s; user-select: none; backdrop-filter: blur(8px);
  }
  .nav-btn:hover { background: rgba(0,245,255,0.12); opacity: 1; }
  .nav-btn:disabled { opacity: 0.2; cursor: not-allowed; }
  .nav-btn svg { width: 14px; height: 14px; fill: currentColor; }
  .page-indicator {
    font-family: 'Orbitron', monospace; font-size: 11px;
    letter-spacing: 2px; color: rgba(0,245,255,0.5);
    min-width: 44px; text-align: center; user-select: none;
  }
  .fullscreen-btn {
    width: 32px; height: 32px; border-radius: 3px;
    background: rgba(5,5,20,0.85); border: 1px solid rgba(123,47,255,0.25);
    color: var(--neon-accent, #7b2fff); cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    opacity: 0.7; transition: all 0.2s; margin-left: 4px; backdrop-filter: blur(8px);
  }
  .fullscreen-btn:hover { background: rgba(123,47,255,0.12); opacity: 1; }
  .transition-overlay {
    position: fixed; inset: 0; z-index: 500;
    background: var(--bg, #030308); opacity: 0;
    pointer-events: none; transition: opacity 0.18s ease;
  }
  .transition-overlay.active { opacity: 1; pointer-events: all; }
  .progress-bar-wrap {
    position: fixed; bottom: 0; left: 0; right: 0; height: 2px;
    background: rgba(0,245,255,0.05); z-index: 1000;
  }
  .progress-bar-fill {
    height: 100%; transition: width 0.35s ease;
    background: linear-gradient(90deg, var(--neon-primary, #00f5ff), var(--neon-accent, #7b2fff));
    box-shadow: 0 0 8px rgba(0,245,255,0.5);
  }
  .hint-toast {
    position: fixed; bottom: 60px; right: 18px;
    background: rgba(5,5,20,0.9); border: 1px solid rgba(0,245,255,0.2);
    border-radius: 4px; padding: 8px 14px; font-size: 11px;
    color: rgba(0,245,255,0.6); font-family: 'Orbitron', monospace;
    letter-spacing: 1px; z-index: 999; opacity: 0;
    transform: translateY(8px); transition: all 0.4s; pointer-events: none;
  }
  .hint-toast.show { opacity: 1; transform: translateY(0); }
</style>
</head>
<body>
<div class="stage">
  <div class="frame-wrap" id="frameWrap">
    <iframe id="slideFrame" src="" allowfullscreen></iframe>
  </div>
</div>
<div class="transition-overlay" id="overlay"></div>
<div class="progress-bar-wrap"><div class="progress-bar-fill" id="progressBar"></div></div>
<div class="nav-ctrl">
  <button class="nav-btn" id="btnPrev" title="上一页 (←)" disabled>
    <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
  </button>
  <div class="page-indicator" id="pageIndicator"></div>
  <button class="nav-btn" id="btnNext" title="下一页 (→)">
    <svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
  </button>
  <button class="fullscreen-btn" id="btnFullscreen" title="全屏 (F)">
    <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
      <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
    </svg>
  </button>
</div>
<div class="hint-toast" id="hintToast">← → 翻页 | F 全屏 | ESC 退出</div>

<script>
const slides = {{SLIDES_ARRAY}};
const TOTAL = slides.length;
let current = 0, transitioning = false;
const frame = document.getElementById('slideFrame');
const overlay = document.getElementById('overlay');
const btnPrev = document.getElementById('btnPrev');
const btnNext = document.getElementById('btnNext');
const indicator = document.getElementById('pageIndicator');
const progressBar = document.getElementById('progressBar');
const frameWrap = document.getElementById('frameWrap');
const hintToast = document.getElementById('hintToast');

function resizeFrame() {
  const vw = window.innerWidth, vh = window.innerHeight;
  let w, h;
  if (vw / vh > 16/9) { h = vh * 0.96; w = h * 16/9; }
  else { w = vw * 0.97; h = w * 9/16; }
  frameWrap.style.width = w + 'px';
  frameWrap.style.height = h + 'px';
}
resizeFrame();
window.addEventListener('resize', resizeFrame);

function updateUI() {
  const pad = n => String(n).padStart(2, '0');
  indicator.textContent = pad(current+1) + ' / ' + pad(TOTAL);
  btnPrev.disabled = current === 0;
  btnNext.disabled = current === TOTAL - 1;
  progressBar.style.width = ((current+1)/TOTAL*100) + '%';
}

function goTo(i) {
  if (transitioning || i < 0 || i >= TOTAL || i === current) return;
  transitioning = true;
  overlay.classList.add('active');
  setTimeout(() => {
    current = i; frame.src = slides[current]; updateUI();
    setTimeout(() => { overlay.classList.remove('active'); transitioning = false; }, 200);
  }, 180);
}
function next() { goTo(current+1); }
function prev() { goTo(current-1); }
btnNext.addEventListener('click', next);
btnPrev.addEventListener('click', prev);

document.addEventListener('keydown', e => {
  switch(e.key) {
    case 'ArrowRight': case 'ArrowDown': case 'PageDown': case ' ':
      e.preventDefault(); next(); break;
    case 'ArrowLeft': case 'ArrowUp': case 'PageUp':
      e.preventDefault(); prev(); break;
    case 'f': case 'F':
      if (!document.fullscreenElement) document.documentElement.requestFullscreen().catch(()=>{});
      else document.exitFullscreen(); break;
    case 'Home': goTo(0); break;
    case 'End': goTo(TOTAL-1); break;
  }
});

let wc = false;
window.addEventListener('wheel', e => {
  if (wc) return; wc = true;
  if (e.deltaY > 0) next(); else prev();
  setTimeout(() => wc = false, 600);
}, {passive:true});

let tx = 0;
window.addEventListener('touchstart', e => { tx = e.touches[0].clientX; }, {passive:true});
window.addEventListener('touchend', e => {
  const dx = e.changedTouches[0].clientX - tx;
  if (Math.abs(dx) > 50) { dx < 0 ? next() : prev(); }
}, {passive:true});

// 初始化
frame.src = slides[0]; updateUI();
setTimeout(() => { hintToast.classList.add('show'); setTimeout(() => hintToast.classList.remove('show'), 3500); }, 1200);
</script>
</body>
</html>
